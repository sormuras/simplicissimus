before_install:
  - java -version
  - wget https://github.com/sormuras/bach/raw/master/install-jdk.sh
  - source install-jdk.sh --feature 15
  - jshell --version
  - echo "GIT_BRANCH=${GIT_BRANCH}"
  - echo "GIT_COMMIT=${GIT_COMMIT}"
  - echo "GIT_DESCRIBE=${GIT_DESCRIBE}"
  - echo "GROUP=${GROUP}"
  - echo "ARTIFACT=${ARTIFACT}"
  - echo "VERSION=${VERSION}"
  - echo "git describe --tags --exact-match=$(git describe --tags --exact-match)"
  - echo "git rev-parse --short HEAD=$(git rev-parse --short HEAD)"

install:
  - version=$([[ $(git describe --tags --exact-match 2>/dev/null) = ${VERSION} ]] && echo "${VERSION}" || echo "2-ea+$(git rev-parse --short HEAD)")
  - jshell -R-Dbach.project.name="simplicissimus" -R-Dbach.project.version="${version}" -R-Dbach.generate-maven-pom-files=true https://sormuras.de/bach/build
  - for files in .bach/workspace/deploy/maven/*.files ; do mvn --batch-mode --no-transfer-progress install:install-file $(cat ${files}) ; done
